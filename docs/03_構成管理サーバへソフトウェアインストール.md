# ISOファイルの作成

yum -y install mkisofs pykickstart

cp -ipv /mnt/hgfs/shared/CentOS-7-x86_64-Minimal-1804.iso /tmp

mount -t iso9660 -o loop /tmp/CentOS-7-x86_64-Minimal-1804.iso /mnt

mkdir ~/base
cp -RT /mnt ~/base
ls ~/base

df

```
[root@localhost ~]# df
ファイルシス            1K-ブロック    使用  使用可 使用% マウント位置
/dev/mapper/centos-root     8374272 3604000 4770272   44% /
devtmpfs                     486748       0  486748    0% /dev
tmpfs                        498976       0  498976    0% /dev/shm
tmpfs                        498976    7840  491136    2% /run
tmpfs                        498976       0  498976    0% /sys/fs/cgroup
/dev/sda1                   1038336  132392  905944   13% /boot
tmpfs                         99796       0   99796    0% /run/user/0
/dev/loop0                   927282  927282       0  100% /mnt
```

umount /dev/loop0
ls /mnt


cp -ipv ~/anaconda-ks.cfg /mnt/hgfs/shared/

```
[root@localhost ~]# diff anaconda-ks.cfg /mnt/hgfs/shared/anaconda-ks.cfg
6,7c6,96,7c6,9
< # Use graphical install
< graphical
---
> # Use text mode install
> text
> # Do not configure the X Window System
> skipx
15a18,20
> # Installation logging level
> logging --level=debug
>
17,18c22,23
< network  --bootproto=dhcp --device=ens33 --ipv6=auto --activate
< network  --bootproto=dhcp --device=ens34 --onboot=off --ipv6=auto --activate
---
> network  --bootproto=dhcp --device=ens192 --ipv6=auto --activate
> network  --bootproto=dhcp --device=ens224 --ipv6=auto --activate
23a29,30
> selinux --disabled
> services --disabled=firewalld
29c36
< autopart --type=lvm
---
> autopart --type=lvm --nohome
49a57,59
>
>
> reboot --eject                  # リブート前にDVDを排出する
```

cp -ipv /mnt/hgfs/shared/anaconda-ks.cfg ~/base/ks.cfg

cd ~/base

ksvalidator ks.cfg

```
cat >> ~/base/isolinux/isolinux.cfg <<EOL

label autorun
  menu label ^KIckStartAutoRun
  menu default
  kernel vmlinuz
  append initrd=initrd.img inst.stage2=cdrom: inst.ks=cdrom:

EOL
```

mkisofs -v -r -J -o ../CentOS-7-KickStart.iso -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table .

ls ~/*.iso

mv ~/CentOS-7-KickStart.iso /mnt/hgfs/shared/

cd
rm -rf ~/base

https://qiita.com/uturned0/items/92f2e75c8533e8465e8b

