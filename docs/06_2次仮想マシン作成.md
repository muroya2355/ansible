# Ansibleのインストール

## pip, python のインストール

yum install -y https://centos7.iuscommunity.org/ius-release.rpm
ls -l /etc/yum.repos.d

yum install epel-release
yum install python2-pip

https://qiita.com/yoshi0518/items/00e6a65535318c8a27df

## ansible のインストール

pip install ansible\==2.8.7
ansible --version
pip2 install pysphere
pip2 show pysphere

yum install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm
yum install -y postgresql12-devel
~/.bash_profileに追記
⇒ export PATH=/usr/pgsql-12/bin:$PATH
. ~/.bash_profile
pip install psycopg2
pip show psycopg2


https://qiita.com/hirofumihida/items/177dd47c5834477b85ec
https://www.kabegiwablog.com/entry/2018/05/02/100000

# yamlファイルの編集

https://docs.ansible.com/ansible/2.7/modules/vsphere_guest_module.html
http://sig9.hatenablog.com/entry/2017/09/26/000000

# ansibleの実行

ansible-playbook --check -i inventory task.yml
ansible-playbook -i inventory task.yml

⇒ [root@localhost esxi-test]# ansible-playbook -i inventory task.yml
[DEPRECATION WARNING]: ...

PLAY [all] *********************************************************************

TASK [vsphere_guest] ***********************************************************
[DEPRECATION WARNING]: ...
changed: [CentOS-1]
changed: [CentOS-2]

PLAY RECAP *********************************************************************
CentOS-1                   : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
CentOS-2                   : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0





yum search python36
yum install -y python36u python36u-libs python36u-devel python36u-pip
python3.6 -m pip install --upgrade pip
python3.6 --version
python3.6 -m pip --version

pip install PyVmomi
pip show PyVmomi

ansible-playbook --check -i inventory task.yml
ansible-playbook -i inventory task.yml

⇒ [root@localhost vmware_guest]# ansible-playbook -i inventory task.yml
[WARNING]: ...


PLAY [all] *********************************************************************

TASK [Create a virtual machine on given ESXi hostname] *************************
fatal: [CentOS-4]: FAILED! => {"ansible_facts": {"discovered_interpreter_python": "/usr/bin/python"}, "changed": false, "msg": "Failed to create virtual machine due to product versioning restrictions: Current license or ESXi version prohibits execution of the requested operation."}
fatal: [CentOS-3]: FAILED! => {"ansible_facts": {"discovered_interpreter_python": "/usr/bin/python"}, "changed": false, "msg": "Failed to create virtual machine due to product versioning restrictions: Current license or ESXi version prohibits execution of the requested operation."}

PLAY RECAP *********************************************************************
CentOS-3                   : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0
CentOS-4                   : ok=0    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0